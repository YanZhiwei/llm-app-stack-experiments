# RAG (Retrieval-Augmented Generation) 入门示例

本目录包含基于最新 OpenAI 和 LangChain 的 RAG 系统实现示例，展示了如何构建智能问答系统。

## 📁 文件结构

```
rag/
├── basic_rag.py           # 基础RAG实现
├── quick_start.py         # 快速开始示例
├── advanced_rag.py        # 高级RAG系统
├── env_example.txt        # 环境变量配置示例
├── sample_docs/           # 示例文档
│   ├── ai_basics.txt      # AI基础知识
│   ├── machine_learning.txt # 机器学习详解
│   └── llm_and_rag.txt    # 大语言模型和RAG技术
└── README.md              # 说明文档
```

## 🚀 快速开始

### 1. 环境准备

确保已安装所需依赖（已在 requirements.txt 中配置）：

```bash
pip install -r requirements.txt
```

### 2. 设置 OpenAI API 密钥

创建 `.env` 文件并添加您的 OpenAI API 密钥：

```bash
# 复制环境变量模板
cp rag/env_example.txt .env

# 编辑 .env 文件，添加您的 API 密钥
OPENAI_API_KEY=your_actual_api_key_here
```

### 3. 运行示例

#### 快速体验 (推荐新手)

```bash
cd rag
python quick_start.py
```

这个示例使用内置的示例数据，无需准备文档文件，可以立即体验 RAG 功能。

#### 基础RAG系统

```bash
cd rag
python basic_rag.py
```

这个示例展示了完整的 RAG 实现流程，使用 sample_docs 目录中的文档。

#### 高级RAG系统

```bash
cd rag
python advanced_rag.py
```

这个示例包含流式响应、混合检索、重排序等高级功能。

## 📚 示例说明

### quick_start.py - 快速开始
- 🎯 **目标**: 快速体验 RAG 功能
- 🔧 **特点**: 
  - 使用内存中的示例数据
  - FAISS 向量存储
  - 简单易懂的实现
  - 内置示例问题和交互式问答

### basic_rag.py - 基础实现
- 🎯 **目标**: 展示完整的 RAG 实现流程
- 🔧 **特点**:
  - 文档加载和处理
  - ChromaDB 向量数据库
  - 可持久化存储
  - 支持多种文档格式

### advanced_rag.py - 高级系统
- 🎯 **目标**: 展示生产级 RAG 系统
- 🔧 **特点**:
  - 混合检索（向量检索 + BM25）
  - 文档压缩和重排序
  - 异步处理
  - 流式响应
  - 多文件格式支持（PDF、Markdown、TXT）

## 🔧 技术栈

- **语言模型**: OpenAI GPT-4
- **嵌入模型**: OpenAI text-embedding-3-large
- **向量数据库**: ChromaDB / FAISS
- **框架**: LangChain
- **文档处理**: PyPDF, UnstructuredMarkdown

## 💡 使用技巧

### 1. 文档准备
- 确保文档内容准确、完整
- 使用清晰的文档结构
- 支持的格式：TXT、PDF、Markdown

### 2. 参数调优
- `chunk_size`: 文档分块大小，影响检索精度
- `chunk_overlap`: 分块重叠，保证上下文连续性
- `k`: 检索返回的文档数量
- `temperature`: 生成温度，控制回答的创造性

### 3. 提示工程
- 设计清晰的提示模板
- 包含必要的上下文信息
- 指导模型的回答格式

## 📊 性能优化

### 检索优化
- 使用合适的嵌入模型
- 调整检索参数（k值、相似度阈值）
- 考虑混合检索策略

### 生成优化
- 控制上下文长度
- 使用适当的温度参数
- 实现流式响应提升用户体验

### 系统优化
- 向量数据库索引优化
- 缓存频繁查询结果
- 批处理文档更新

## 🎯 应用场景

1. **企业知识库问答**
   - 内部文档检索
   - 政策规程查询
   - 技术文档助手

2. **客户服务**
   - 产品手册问答
   - 常见问题解答
   - 智能客服系统

3. **学术研究**
   - 论文文献检索
   - 研究资料整理
   - 知识图谱构建

4. **个人助理**
   - 笔记整理
   - 知识管理
   - 学习辅助

## 🚨 注意事项

1. **API 费用**: OpenAI API 调用会产生费用，请合理使用
2. **数据隐私**: 确保敏感数据安全，考虑本地部署
3. **模型限制**: 注意上下文长度限制和速率限制
4. **质量控制**: 定期评估系统输出质量

## 🔍 故障排除

### 常见问题

1. **API 密钥错误**
   ```
   错误: 请设置OPENAI_API_KEY环境变量
   ```
   解决: 检查 .env 文件中的 API 密钥配置

2. **文档加载失败**
   ```
   错误: 路径不存在
   ```
   解决: 确保 sample_docs 目录存在且包含文档文件

3. **向量数据库错误**
   ```
   错误: ChromaDB 初始化失败
   ```
   解决: 清除现有数据库目录重新创建

### 调试建议

- 启用详细日志输出
- 检查文档预处理结果
- 验证检索结果质量
- 监控 API 调用状态

## 📈 扩展方向

1. **多模态支持**: 添加图像、音频处理能力
2. **实时更新**: 实现增量索引更新
3. **个性化**: 基于用户历史优化检索
4. **评估系统**: 自动化质量评估
5. **Web 界面**: 开发友好的用户界面

## 📞 获取帮助

如果遇到问题或有改进建议，欢迎：
- 查看代码注释了解实现细节
- 参考 LangChain 官方文档
- 测试不同的参数配置
- 尝试使用自己的文档数据

祝您使用愉快！🎉 